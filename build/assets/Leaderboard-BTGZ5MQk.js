import{j as e}from"./ui-vendor-DeL-jnW0.js";import{h as C,r as o,u as N}from"./react-vendor-BRxAXmoz.js";import{A as I,i as E}from"./index-CtH3Z_vz.js";import{C as d,d as v,B as z,j as H,k as n,l as c,m as L,T as P,e as s,s as A,c as B}from"./antd-vendor-DXVleyxb.js";const{Title:S}=P,Q=()=>{var p,j,g;const{code:l}=C(),[r,q]=o.useState({quiz:{},leaderboard:[],submissionHistory:[],metadata:{}}),[u,w]=o.useState(!0),[h,x]=o.useState(null),m=N(),{auth:T}=o.useContext(I);o.useEffect(()=>{(async()=>{var i,f,b,y;try{const t=await E.get(`/api/quiz/leaderboard/${l}`);if(t.data.success)q({quiz:t.data.quiz,leaderboard:t.data.leaderboard,submissionHistory:t.data.submissionHistory,metadata:t.data.metadata}),x(null);else throw new Error(t.data.error||"Failed to fetch leaderboard")}catch(t){console.error("Error fetching leaderboard:",t),x(((f=(i=t.response)==null?void 0:i.data)==null?void 0:f.error)||"Failed to fetch leaderboard"),A.error(((y=(b=t.response)==null?void 0:b.data)==null?void 0:y.error)||"Failed to fetch leaderboard")}finally{w(!1)}})()},[l]);const k=[{title:"Rank",dataIndex:"rank",key:"rank",width:"15%",render:a=>e.jsxs(s,{color:a===1?"gold":a===2?"silver":a===3?"bronze":"default",children:["#",a]})},{title:"Player",dataIndex:"username",key:"username",width:"35%",render:(a,i)=>e.jsxs(B,{children:[a,i.userId===T.userId&&e.jsx(s,{color:"green",children:"You"})]})},{title:"Score",dataIndex:"score",key:"score",width:"25%",render:a=>e.jsxs(s,{color:"blue",children:[a," points"]})},{title:"Percentage",dataIndex:"percentage",key:"percentage",width:"25%",render:a=>e.jsxs(s,{color:a>=70?"green":a>=40?"orange":"red",children:[a,"%"]})}];return u?e.jsx("div",{className:"auth-container",children:e.jsx(d,{loading:!0,className:"auth-card",children:"Loading..."})}):h?e.jsx("div",{className:"auth-container",children:e.jsx(d,{className:"auth-card",children:e.jsx(v,{status:"error",title:"Failed to load leaderboard",subTitle:h,extra:[e.jsx(z,{type:"primary",onClick:()=>m("/home"),children:"Back to Home"},"home")]})})}):e.jsx("div",{className:"auth-container",children:e.jsxs(d,{title:e.jsxs("div",{children:[e.jsx(S,{level:3,children:r.quiz.title||"Quiz Leaderboard"}),e.jsxs(S,{level:5,children:["Quiz Code: ",e.jsx(s,{color:"cyan",children:l}),r.quiz.category&&e.jsx(s,{color:"purple",style:{marginLeft:8},children:r.quiz.category})]}),e.jsx(s,{color:r.quiz.status==="completed"?"green":"blue",children:((p=r.quiz.status)==null?void 0:p.charAt(0).toUpperCase())+((j=r.quiz.status)==null?void 0:j.slice(1))})]}),className:"auth-card",children:[e.jsxs(H,{gutter:16,style:{marginBottom:24},children:[e.jsx(n,{span:8,children:e.jsx(c,{title:"Average Score",value:Math.round(r.metadata.averageScore*10)/10,suffix:"points"})}),e.jsx(n,{span:8,children:e.jsx(c,{title:"Highest Score",value:r.metadata.highestScore,suffix:"points",valueStyle:{color:"#3f8600"}})}),e.jsx(n,{span:8,children:e.jsx(c,{title:"Total Participants",value:r.quiz.totalParticipants||0})})]}),((g=r.leaderboard)==null?void 0:g.length)>0?e.jsx(L,{dataSource:r.leaderboard,columns:k,pagination:!1,loading:u,rowKey:"userId",className:"leaderboard-table"}):e.jsx(v,{status:"info",title:"No Results Yet",subTitle:"The leaderboard is currently empty. Please wait for the quiz to complete."}),e.jsx("div",{style:{marginTop:"20px",textAlign:"center"},children:e.jsx(z,{type:"primary",onClick:()=>m("/home"),size:"large",children:"Back to Home"})})]})})};export{Q as default};
